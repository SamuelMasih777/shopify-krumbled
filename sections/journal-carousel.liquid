{% schema %}
{
  "name": "Journal Carousel",
  "settings": [
    {
      "type": "header",
      "content": "Section Settings"
    },
    {
      "type": "text",
      "id": "section_title",
      "label": "Section Title",
      "default": "On the Journal"
    },
    {
      "type": "text",
      "id": "section_subtitle",
      "label": "Section Subtitle",
      "default": "TAKE A MOMENT TO PAUSE."
    },
    {
      "type": "font_picker",
      "id": "title_font",
      "label": "Title Font",
      "default": "serif"
    },
    {
      "type": "range",
      "id": "title_size",
      "min": 32,
      "max": 72,
      "step": 2,
      "unit": "px",
      "label": "Title Size",
      "default": 48
    },
    {
      "type": "color",
      "id": "title_color",
      "label": "Title Color",
      "default": "#2a2a2a"
    },
    {
      "type": "color",
      "id": "bg_color",
      "label": "Background Color",
      "default": "#f9f9f9"
    },
    {
      "type": "range",
      "id": "section_padding",
      "min": 40,
      "max": 100,
      "step": 10,
      "unit": "px",
      "label": "Section Padding",
      "default": 80
    }
  ],
  "blocks": [
    {
      "type": "journal_item",
      "name": "Journal Item",
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "Image"
        },
        {
          "type": "text",
          "id": "category",
          "label": "Category Tags",
          "default": "LIFESTYLE"
        },
        {
          "type": "text",
          "id": "title",
          "label": "Article Title",
          "default": "Article Title"
        },
        {
          "type": "url",
          "id": "url",
          "label": "Article URL"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Journal Carousel",
      "blocks": [
        {
          "type": "journal_item",
          "settings": {
            "category": "FOUNDER 路 MOTHERHOOD",
            "title": "5 Ways To Balance Motherhood With Bus..."
          }
        },
        {
          "type": "journal_item",
          "settings": {
            "category": "LIFESTYLE 路 WELLBEING",
            "title": "How to Spring Clean your Skin"
          }
        },
        {
          "type": "journal_item",
          "settings": {
            "category": "RECIPE",
            "title": "Collagen Bliss Balls"
          }
        },
        {
          "type": "journal_item",
          "settings": {
            "category": "NUTRITIONIST 路 NATUROPATH 路 WELLBEING",
            "title": "A Simple Guide to Gut Health"
          }
        },
        {
          "type": "journal_item",
          "settings": {
            "category": "BUSINESS",
            "title": "Women in Business Spotlight"
          }
        }
      ]
    }
  ]
}
{% endschema %}

<style>
.journal-carousel-section {
  background-color: {{ section.settings.bg_color }};
  padding: {{ section.settings.section_padding }}px 40px;
}

.journal-header {
  text-align: center;
  margin-bottom: 60px;
}

.journal-subtitle {
  font-size: 11px;
  letter-spacing: 2.5px;
  text-transform: uppercase;
  font-weight: 600;
  color: #999;
  margin-bottom: 20px;
}

.journal-title {
  font-family: {{ section.settings.title_font.family }}, {{ section.settings.title_font.fallback_families }};
  font-size: {{ section.settings.title_size }}px;
  font-weight: 400;
  color: {{ section.settings.title_color }};
  line-height: 1.2;
  margin: 0;
  letter-spacing: -0.5px;
}

.journal-carousel-wrapper {
  position: relative;
  width: 100%;
  overflow: hidden;
}

.journal-carousel-track {
  display: flex;
  gap: 20px;
  overflow-x: auto;
  scroll-behavior: smooth;
  padding-bottom: 15px;
  scrollbar-width: none;
}

.journal-carousel-track::-webkit-scrollbar {
  display: none;
}

.journal-item {
  flex: 0 0 calc(20% - 16px);
  min-width: calc(20% - 16px);
  position: relative;
  overflow: hidden;
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.3s ease;
  group: "journal-item";
}

.journal-item:hover {
  transform: translateY(-8px);
}

.journal-item-image {
  position: relative;
  width: 100%;
  padding-bottom: 125%;
  overflow: hidden;
  background: linear-gradient(135deg, #f5f5f5 0%, #e0e0e0 100%);
}

.journal-item-image img {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: block;
  transition: transform 0.3s ease;
}

.journal-item:hover .journal-item-image img {
  transform: scale(1.05);
}

.journal-item-overlay {
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  top: 0;
  background: linear-gradient(to top, rgba(0, 0, 0, 0.8) 0%, rgba(0, 0, 0, 0.4) 40%, transparent 100%);
  padding: 20px;
  display: flex;
  flex-direction: column;
  justify-content: flex-end;
  transition: all 0.3s ease;
}

.journal-item-content {
  color: white;
  position: relative;
  z-index: 2;
}

.journal-item-category {
  font-size: 9px;
  letter-spacing: 1.5px;
  text-transform: uppercase;
  font-weight: 700;
  color: rgba(255, 255, 255, 0.85);
  margin-bottom: 12px;
  line-height: 1.4;
  display: block;
}

.journal-item-title {
  font-size: 14px;
  font-weight: 500;
  color: white;
  line-height: 1.4;
  margin: 0;
  letter-spacing: -0.3px;
}

.journal-dots {
  display: flex;
  justify-content: center;
  gap: 8px;
  margin-top: 30px;
}

.journal-dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background-color: #ddd;
  border: none;
  cursor: pointer;
  transition: all 0.3s ease;
  padding: 0;
}

.journal-dot:hover {
  background-color: #bbb;
  transform: scale(1.2);
}

.journal-dot.active {
  background-color: #333;
  transform: scale(1.3);
  width: 24px;
  border-radius: 4px;
}

@media (max-width: 1440px) {
  .journal-item {
    flex: 0 0 calc(25% - 15px);
    min-width: calc(25% - 15px);
  }
}

@media (max-width: 1024px) {
  .journal-carousel-section {
    padding: 60px 30px;
  }

  .journal-title {
    font-size: clamp(36px, 5vw, {{ section.settings.title_size }}px);
  }

  .journal-header {
    margin-bottom: 40px;
  }

  .journal-item {
    flex: 0 0 calc(33.333% - 13px);
    min-width: calc(33.333% - 13px);
  }

  .journal-item-title {
    font-size: 13px;
  }

  .journal-item-category {
    font-size: 8px;
  }
}

@media (max-width: 768px) {
  .journal-carousel-section {
    padding: 50px 20px;
  }

  .journal-title {
    font-size: clamp(28px, 6vw, 48px);
  }

  .journal-subtitle {
    font-size: 10px;
  }

  .journal-header {
    margin-bottom: 30px;
  }

  .journal-item {
    flex: 0 0 calc(50% - 10px);
    min-width: calc(50% - 10px);
  }

  .journal-item-title {
    font-size: 12px;
  }

  .journal-item-category {
    font-size: 7px;
    margin-bottom: 8px;
  }

  .journal-item-overlay {
    padding: 15px;
  }
}

@media (max-width: 480px) {
  .journal-carousel-section {
    padding: 40px 15px;
  }

  .journal-title {
    font-size: 28px;
  }

  .journal-item {
    flex: 0 0 calc(100% - 0px);
    min-width: 100%;
  }
}
</style>

<section class="journal-carousel-section">
  <div class="journal-header">
    {% if section.settings.section_subtitle %}
      <p class="journal-subtitle">{{ section.settings.section_subtitle }}</p>
    {% endif %}
    {% if section.settings.section_title %}
      <h2 class="journal-title">{{ section.settings.section_title }}</h2>
    {% endif %}
  </div>

  <div class="journal-carousel-wrapper">
    <div class="journal-carousel-track" id="carouselTrack">
      {% for block in section.blocks %}
        <a href="{{ block.settings.url }}" class="journal-item" {{ block.shopify_attributes }}>
          <div class="journal-item-image">
            {% if block.settings.image %}
              <img src="{{ block.settings.image | image_url: width: 800 }}" alt="{{ block.settings.title }}" loading="lazy">
            {% else %}
              <div style="width: 100%; height: 100%; background: linear-gradient(135deg, #e8e8e8 0%, #d0d0d0 100%); display: flex; align-items: center; justify-content: center; color: #999; font-size: 13px; text-align: center; padding: 20px;">
                <span>Add Image</span>
              </div>
            {% endif %}
          </div>

          <div class="journal-item-overlay">
            <div class="journal-item-content">
              {% if block.settings.category %}
                <span class="journal-item-category">{{ block.settings.category }}</span>
              {% endif %}
              {% if block.settings.title %}
                <h3 class="journal-item-title">{{ block.settings.title }}</h3>
              {% endif %}
            </div>
          </div>
        </a>
      {% endfor %}
    </div>
  </div>

  <div class="journal-dots" id="carouselDots"></div>
</section>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const track = document.getElementById('carouselTrack');
  const dotsContainer = document.getElementById('carouselDots');
  const items = track.querySelectorAll('.journal-item');
  
  if (items.length === 0) return;

  // Create dots
  items.forEach((item, index) => {
    const dot = document.createElement('button');
    dot.className = 'journal-dot' + (index === 0 ? ' active' : '');
    dot.setAttribute('aria-label', `Go to slide ${index + 1}`);
    dot.addEventListener('click', () => scrollToItem(index));
    dotsContainer.appendChild(dot);
  });

  const dots = dotsContainer.querySelectorAll('.journal-dot');

  function scrollToItem(index) {
    const item = items[index];
    const trackRect = track.getBoundingClientRect();
    const itemRect = item.getBoundingClientRect();
    const scrollLeft = item.offsetLeft - (track.clientWidth / 2) + (item.offsetWidth / 2);
    
    track.scrollTo({
      left: scrollLeft,
      behavior: 'smooth'
    });

    dots.forEach((dot, i) => {
      dot.classList.toggle('active', i === index);
    });
  }

  // Update active dot on scroll
  track.addEventListener('scroll', () => {
    let currentIndex = 0;
    const trackCenter = track.scrollLeft + track.clientWidth / 2;

    items.forEach((item, index) => {
      const itemCenter = item.offsetLeft + item.offsetWidth / 2;
      if (itemCenter <= trackCenter) {
        currentIndex = index;
      }
    });

    dots.forEach((dot, i) => {
      dot.classList.toggle('active', i === currentIndex);
    });
  });
});
</script>
